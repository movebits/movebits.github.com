
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Presentation - Useful Rails Concepts</title>
    <meta name="description" content="">
    <meta name="author" content="movebits">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <!-- syntax highlighting CSS -->
    
    <link href="/assets/themes/twitter/css/syntax.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/src/nv.d3.css" rel="stylesheet" type="text/css">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <style>

    

    svg {
      display: block;
    }

    

    </style>

  </head>

  <body>
    <div style="display: ">
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">movebits</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>
  </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>Presentation - Useful Rails Concepts </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>23 May 2013</span>
    </div>
    <div class="content">
      <p>referring to Slide Presentation (Slide Numbers) see PDF - <a href='/assets/useful-rails-concepts-slides.pdf'>useful-rails-concepts-slides.pdf</a></p>

<h2 id='rails_api__slide_3'>Rails API - Slide 3</h2>

<h3 id='rails_api'>Rails API</h3>

<p><a href='https://github.com/rails-api/rails-api'>https://github.com/rails-api/rails-api</a></p>

<p>For new apps - Install the gem if you haven&#8217;t already:</p>

<pre><code>gem install rails-api</code></pre>

<p>Then generate a new <code>Rails::API</code> app:</p>

<pre><code>rails-api new my_api</code></pre>

<h3 id='ams__active_model_serializers'>AMS - Active Model Serializers</h3>

<p><a href='https://github.com/rails-api/active_model_serializers'>https://github.com/rails-api/active_model_serializers</a></p>

<p>The easiest way to create a new serializer is to generate a new resource, which will generate a serializer at the same time:</p>

<pre><code>rails g resource post title:string body:string</code></pre>

<p>This will generate a serializer in <code>app/serializers/post_serializer.rb</code> for your new model. You can also generate a serializer for an existing model with the serializer generator:</p>

<pre><code>rails g serializer post</code></pre>

<p>Example of created serializer:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>PostSerializer</span> <span class='o'>&lt;</span> <span class='ss'>ActiveModel</span><span class='p'>:</span><span class='ss'>:Serializer</span>
  <span class='n'>attributes</span> <span class='ss'>:id</span><span class='p'>,</span> <span class='ss'>:title</span><span class='p'>,</span> <span class='ss'>:string</span>
<span class='k'>end</span>
</code></pre></div>
<p>Navigating to the URL <code>localhost/posts</code> would then render a <code>JSON</code> string response. The <code>rails g resource</code> command would already have created an entry in <code>routes.rb</code> to include the posts resource, as such allowing <code>index</code> access, rendering posts.json.</p>

<h3 id='api_access_tokens'>API access, Tokens</h3>

<p>to wrap an API, include in <code>routes.rb</code>, for example using the <code>products</code> resource:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>namespace</span> <span class='ss'>:api</span> <span class='k'>do</span>
  <span class='n'>namespace</span> <span class='ss'>:v1</span> <span class='k'>do</span>
    <span class='n'>resources</span> <span class='ss'>:products</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p>then create a controller in <code>api/v1/products_controller</code>, where the <code>before_filter :restrict_access</code> calls the token authentication, which is an API table containing a row with the SHA1 hash. If you navigate to e.g. <code>localhost/api/v1/products.json?access_token=1234d607b688b43841f1c6ccfe57a69e</code></p>
<div class='highlight'><pre><code class='ruby'><span class='k'>module</span> <span class='nn'>Api</span>
  <span class='k'>module</span> <span class='nn'>V1</span>
    <span class='k'>class</span> <span class='nc'>ProductsController</span> <span class='o'>&lt;</span> <span class='no'>ApplicationController</span>
      <span class='n'>before_filter</span> <span class='ss'>:restrict_access</span>
      <span class='n'>skip_before_filter</span> <span class='ss'>:require_login</span><span class='p'>,</span> <span class='ss'>:only</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='ss'>:index</span><span class='p'>,</span> <span class='ss'>:show</span><span class='o'>]</span>
      <span class='n'>respond_to</span> <span class='ss'>:json</span>
      <span class='n'>caches_action</span> <span class='ss'>:index</span><span class='p'>,</span> <span class='ss'>:show</span>
      
      <span class='k'>def</span> <span class='nf'>index</span>
        
        <span class='vi'>@products</span> <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>all</span>

        <span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>
          
          <span class='nb'>format</span><span class='o'>.</span><span class='n'>json</span> <span class='p'>{</span> <span class='n'>render</span> <span class='ss'>json</span><span class='p'>:</span> <span class='vi'>@products</span><span class='p'>,</span> <span class='ss'>:only</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='ss'>:id</span><span class='p'>,</span> <span class='ss'>:level</span><span class='p'>,</span> <span class='ss'>:condo_no</span><span class='p'>,</span> <span class='ss'>:sales_no</span><span class='p'>,</span> <span class='ss'>:sqr_ft</span><span class='p'>,</span> <span class='ss'>:schedule_b</span><span class='p'>,</span> <span class='ss'>:seating</span><span class='p'>,</span> <span class='ss'>:restaurant</span><span class='p'>,</span> <span class='ss'>:hair</span><span class='p'>,</span> <span class='ss'>:food</span><span class='p'>,</span> <span class='ss'>:herbs_dsf</span><span class='p'>,</span> <span class='ss'>:pets</span><span class='p'>,</span> <span class='ss'>:extended_hours</span><span class='p'>,</span> <span class='ss'>:standard_hours</span><span class='p'>,</span> <span class='ss'>:category_txt</span><span class='p'>,</span> <span class='ss'>:availability</span><span class='p'>,</span> <span class='ss'>:price</span><span class='p'>,</span> <span class='ss'>:notes</span><span class='o'>]</span> <span class='p'>}</span>
        <span class='k'>end</span>
        <span class='ss'>ActiveRecord</span><span class='p'>:</span><span class='ss'>:Base</span><span class='o'>.</span><span class='n'>include_root_in_json</span> <span class='o'>=</span> <span class='kp'>false</span>
      <span class='k'>end</span>
      
      <span class='k'>def</span> <span class='nf'>show</span>
        <span class='vi'>@product</span> <span class='o'>=</span> <span class='no'>Product</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:id</span><span class='o'>]</span><span class='p'>)</span>

        <span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>

          <span class='nb'>format</span><span class='o'>.</span><span class='n'>json</span> <span class='p'>{</span> <span class='n'>render</span> <span class='ss'>json</span><span class='p'>:</span> <span class='vi'>@product</span><span class='p'>,</span> <span class='ss'>:only</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='ss'>:id</span><span class='p'>,</span> <span class='ss'>:level</span><span class='p'>,</span> <span class='ss'>:condo_no</span><span class='p'>,</span> <span class='ss'>:sales_no</span><span class='p'>,</span> <span class='ss'>:sqr_ft</span><span class='p'>,</span> <span class='ss'>:schedule_b</span><span class='p'>,</span> <span class='ss'>:seating</span><span class='p'>,</span> <span class='ss'>:restaurant</span><span class='p'>,</span> <span class='ss'>:hair</span><span class='p'>,</span> <span class='ss'>:food</span><span class='p'>,</span> <span class='ss'>:herbs_dsf</span><span class='p'>,</span> <span class='ss'>:pets</span><span class='p'>,</span> <span class='ss'>:extended_hours</span><span class='p'>,</span> <span class='ss'>:standard_hours</span><span class='p'>,</span> <span class='ss'>:category_txt</span><span class='p'>,</span> <span class='ss'>:availability</span><span class='p'>,</span> <span class='ss'>:price</span><span class='p'>,</span> <span class='ss'>:notes</span><span class='o'>]</span> <span class='p'>}</span>
        <span class='k'>end</span>

        <span class='ss'>ActiveRecord</span><span class='p'>:</span><span class='ss'>:Base</span><span class='o'>.</span><span class='n'>include_root_in_json</span> <span class='o'>=</span> <span class='kp'>false</span>
      <span class='k'>end</span>

      <span class='k'>def</span> <span class='nf'>restrict_access</span>
        <span class='n'>api_key</span> <span class='o'>=</span> <span class='no'>ApiKey</span><span class='o'>.</span><span class='n'>find_by_access_token</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:access_token</span><span class='o'>]</span><span class='p'>)</span>
        <span class='n'>head</span> <span class='ss'>:unauthorized</span> <span class='k'>unless</span> <span class='n'>api_key</span>
      <span class='k'>end</span>

      <span class='k'>def</span> <span class='nf'>restrict_access2</span>
        <span class='n'>authenticate_or_request_with_http_token</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>token</span><span class='p'>,</span> <span class='n'>options</span><span class='o'>|</span>
          <span class='no'>ApiKey</span><span class='o'>.</span><span class='n'>exists?</span><span class='p'>(</span><span class='n'>access_token</span><span class='p'>:</span> <span class='n'>token</span><span class='p'>)</span>
        <span class='k'>end</span>
      <span class='k'>end</span>
      
      
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p>For token based access - Railscasts episode <code>#352</code> is helpful <a href='http://railscasts.com/episodes/352-securing-an-api?view=asciicast'>http://railscasts.com/episodes/352-securing-an-api?view=asciicast</a></p>

<h3 id='security_strong_params_whitelisting'>Security, Strong Params, whitelisting</h3>

<p>By default Rails now creates whitelisted accessors in models to control access to attributes. Previously, a security hole was discovered that allowed a malicious web app to send updates to attributes (Mass Assignment) through the helper methods <code>update_attributes</code> and <code>new</code>.</p>

<p>Example of previously unsafe <code>update_attributes</code> method in controller method <code>update</code>:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>update</span>
  <span class='vi'>@order</span> <span class='o'>=</span> <span class='no'>Order</span><span class='o'>.</span><span class='n'>find</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:id</span><span class='o'>]</span><span class='p'>)</span>

  <span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>
    <span class='k'>if</span> <span class='vi'>@order</span><span class='o'>.</span><span class='n'>update_attributes</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:order</span><span class='o'>]</span><span class='p'>)</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>html</span> <span class='p'>{</span> <span class='n'>redirect_to</span> <span class='vi'>@order</span><span class='p'>,</span> <span class='ss'>notice</span><span class='p'>:</span> <span class='s1'>&#39;Order was successfully updated.&#39;</span> <span class='p'>}</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>json</span> <span class='p'>{</span> <span class='n'>head</span> <span class='ss'>:no_content</span> <span class='p'>}</span>
    <span class='k'>else</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>html</span> <span class='p'>{</span> <span class='n'>render</span> <span class='ss'>action</span><span class='p'>:</span> <span class='s2'>&quot;edit&quot;</span> <span class='p'>}</span>
      <span class='nb'>format</span><span class='o'>.</span><span class='n'>json</span> <span class='p'>{</span> <span class='n'>render</span> <span class='ss'>json</span><span class='p'>:</span> <span class='vi'>@order</span><span class='o'>.</span><span class='n'>errors</span><span class='p'>,</span> <span class='ss'>status</span><span class='p'>:</span> <span class='ss'>:unprocessable_entity</span> <span class='p'>}</span>
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p>See also <code>Rails Guides</code> Security Article on Mass Assignment - <a href='http://guides.rubyonrails.org/security.html#mass-assignment'>http://guides.rubyonrails.org/security.html#mass-assignment</a></p>

<pre><code>Without any precautions Model.new(params[:model]) would allow attackers to set any database 
column’s value.</code></pre>

<p>The mass-assignment feature may become a problem, as it allows an attacker to set any model’s attributes by manipulating the hash passed to a model’s new() method:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>signup</span>
  <span class='n'>params</span><span class='o'>[</span><span class='ss'>:user</span><span class='o'>]</span> <span class='c1'># =&gt; {:name =&gt; “ow3ned”, :admin =&gt; true}</span>
  <span class='vi'>@user</span> <span class='o'>=</span> <span class='no'>User</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='n'>params</span><span class='o'>[</span><span class='ss'>:user</span><span class='o'>]</span><span class='p'>)</span>
<span class='k'>end</span>
</code></pre></div>
<p>Mass-assignment allows passing in a hash to the <code>new</code> method, or <code>assign_attributes=</code> to set the model’s attributes to the values in the hash. It is often used with the parameters (params) hash available in controller, which may be used with malicious intent. Changing URL example:</p>

<p>Simple <code>GET</code> request <code>http://www.example.com/user/signup?user[name]=ow3ned&amp;user[admin]=1</code></p>

<p>It&#8217;s worth reading the Rails security Guide - <a href='http://guides.rubyonrails.org/security.html'>http://guides.rubyonrails.org/security.html</a></p>

<p>Example of whitelisting params in model - is generated automatically upon resource creation (e.g. <code>rails g resource ProductDetail ProductID:string ProductName:string :ProductUPCCode:string</code>) or scaffold creation (replace <code>resource</code> in generate command with <code>scaffold</code> if one needs HTML views):</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>ProductDetail</span> <span class='o'>&lt;</span> <span class='ss'>ActiveRecord</span><span class='p'>:</span><span class='ss'>:Base</span>
  <span class='n'>attr_accessible</span> <span class='ss'>:ProductId</span><span class='p'>,</span> <span class='ss'>:ProductName</span><span class='p'>,</span> <span class='ss'>:ProductUPCCode</span>
<span class='k'>end</span>
</code></pre></div>
<h2 id='routes__slide_12'>Routes - Slide 12</h2>

<h3 id='routes'>Routes</h3>

<p>RESTful routes creation with <code>resources :products</code> vs. using <code>match</code> (catch-all for get and post), <code>get</code>, <code>post</code>.</p>

<p>Catch params (<code>params[:id]</code>) with <code>match &quot;store/categories/(:id)&quot; =&gt; &quot;store#categories&quot;</code>.</p>

<h3 id='route_nesting'>Route nesting</h3>

<p>Nest routes with e.g.</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>resources</span> <span class='ss'>:blogs</span> <span class='k'>do</span>
  <span class='n'>resources</span> <span class='ss'>:posts</span>
<span class='k'>end</span>

<span class='n'>resources</span> <span class='ss'>:posts</span> <span class='k'>do</span>
  <span class='n'>resources</span> <span class='ss'>:comments</span>
<span class='k'>end</span>
</code></pre></div>
<p>There is an article by Jamis Buck (37 Signals) about avoiding deeply nested routes - see <a href='http://weblog.jamisbuck.org/2007/2/5/nesting-resources'>http://weblog.jamisbuck.org/2007/2/5/nesting-resources</a>. See also Rails Guides routing - <a href='http://guides.rubyonrails.org/routing.html'>http://guides.rubyonrails.org/routing.html</a></p>

<p>Specifically <a href='http://guides.rubyonrails.org/routing.html#crud-verbs-and-actions'>http://guides.rubyonrails.org/routing.html#crud-verbs-and-actions</a> e.g. <code>resources :photos</code> command creates 7 different routes on the Photos controller:</p>
<table>
  <tbody><tr>
    <th><span class='caps'>HTTP</span> Verb </th>
    <th>Path            </th>
    <th>action </th>
    <th>used for                                   </th>
  </tr>
  <tr>
    <td><span class='caps'>GET</span>          </td>
    <td>/photos           </td>
    <td>index    </td>
    <td>display a list of all photos                 </td>
  </tr>
  <tr>
    <td><span class='caps'>GET</span>          </td>
    <td>/photos/new       </td>
    <td>new      </td>
    <td>return an <span class='caps'>HTML</span> form for creating a new photo </td>
  </tr>
  <tr>
    <td><span class='caps'>POST</span>         </td>
    <td>/photos           </td>
    <td>create   </td>
    <td>create a new photo                           </td>
  </tr>
  <tr>
    <td><span class='caps'>GET</span>          </td>
    <td>/photos/:id       </td>
    <td>show     </td>
    <td>display a specific photo                     </td>
  </tr>
  <tr>
    <td><span class='caps'>GET</span>          </td>
    <td>/photos/:id/edit  </td>
    <td>edit     </td>
    <td>return an <span class='caps'>HTML</span> form for editing a photo      </td>
  </tr>
  <tr>
    <td><span class='caps'>PUT</span>          </td>
    <td>/photos/:id       </td>
    <td>update   </td>
    <td>update a specific photo                      </td>
  </tr>
  <tr>
    <td><span class='caps'>DELETE</span>       </td>
    <td>/photos/:id       </td>
    <td>destroy  </td>
    <td>delete a specific photo                      </td>
  </tr>
</tbody></table>
<h3 id='rake_routes'>rake routes</h3>

<p><code>rake routes</code> command shows all available routes and their named paths, which can be used to e.g. generate link helpers. <code>edit_post_comment</code> refers and generates the route <code>GET    /posts/:post_id/comments/:id/edit(.:format)</code>:</p>

<pre><code>          post_comments GET    /posts/:post_id/comments(.:format)          {:action=&gt;&quot;index&quot;, :controller=&gt;&quot;comments&quot;}
                        POST   /posts/:post_id/comments(.:format)          {:action=&gt;&quot;create&quot;, :controller=&gt;&quot;comments&quot;}
       new_post_comment GET    /posts/:post_id/comments/new(.:format)      {:action=&gt;&quot;new&quot;, :controller=&gt;&quot;comments&quot;}
      edit_post_comment GET    /posts/:post_id/comments/:id/edit(.:format) {:action=&gt;&quot;edit&quot;, :controller=&gt;&quot;comments&quot;}
           post_comment GET    /posts/:post_id/comments/:id(.:format)      {:action=&gt;&quot;show&quot;, :controller=&gt;&quot;comments&quot;}
                        PUT    /posts/:post_id/comments/:id(.:format)      {:action=&gt;&quot;update&quot;, :controller=&gt;&quot;comments&quot;}
                        DELETE /posts/:post_id/comments/:id(.:format)      {:action=&gt;&quot;destroy&quot;, :controller=&gt;&quot;comments&quot;}
                  posts GET    /posts(.:format)                            {:action=&gt;&quot;index&quot;, :controller=&gt;&quot;posts&quot;}
                        POST   /posts(.:format)                            {:action=&gt;&quot;create&quot;, :controller=&gt;&quot;posts&quot;}
               new_post GET    /posts/new(.:format)                        {:action=&gt;&quot;new&quot;, :controller=&gt;&quot;posts&quot;}
              edit_post GET    /posts/:id/edit(.:format)                   {:action=&gt;&quot;edit&quot;, :controller=&gt;&quot;posts&quot;}
                   post GET    /posts/:id(.:format)                        {:action=&gt;&quot;show&quot;, :controller=&gt;&quot;posts&quot;}
                        PUT    /posts/:id(.:format)                        {:action=&gt;&quot;update&quot;, :controller=&gt;&quot;posts&quot;}
                        DELETE /posts/:id(.:format)                        {:action=&gt;&quot;destroy&quot;, :controller=&gt;&quot;posts&quot;}
               comments GET    /comments(.:format)                         {:action=&gt;&quot;index&quot;, :controller=&gt;&quot;comments&quot;}
                        POST   /comments(.:format)                         {:action=&gt;&quot;create&quot;, :controller=&gt;&quot;comments&quot;}
            new_comment GET    /comments/new(.:format)                     {:action=&gt;&quot;new&quot;, :controller=&gt;&quot;comments&quot;}
           edit_comment GET    /comments/:id/edit(.:format)                {:action=&gt;&quot;edit&quot;, :controller=&gt;&quot;comments&quot;}
                comment GET    /comments/:id(.:format)                     {:action=&gt;&quot;show&quot;, :controller=&gt;&quot;comments&quot;}
                        PUT    /comments/:id(.:format)                     {:action=&gt;&quot;update&quot;, :controller=&gt;&quot;comments&quot;}
                        DELETE /comments/:id(.:format)                     {:action=&gt;&quot;destroy&quot;, :controller=&gt;&quot;comments&quot;}</code></pre>

<h2 id='spa_single_page_apps__slide_4'>SPA Single Page Apps - Slide 4</h2>

<h3 id='example_of_standard_jquery_ajax_use_in_rails'>Example of Standard jQuery/ Ajax use in Rails</h3>

<p>Good jQuery reference for Ajax etc. - <a href='http://jqfundamentals.com/'>http://jqfundamentals.com/</a></p>

<h4 id='ajax_get_request'>Ajax GET Request</h4>

<p>e.g. a music track selector widget:</p>

<p><img alt='selector widget' src='/assets/get_tracks.png' /></p>

<p>Html page includes two selectors and a link (action), where jQuery references the two id fields <code>categories</code> and <code>sort</code> in the event of <code>click</code>, binding events to these id&#8217;s with jQuery&#8217;s <code>live</code> capture (one could just use the <code>click</code> event, but then it would not register changes from both selectors):</p>
<div class='highlight'><pre><code class='javascript'><span class='o'>&lt;</span><span class='nx'>script</span> <span class='nx'>type</span><span class='o'>=</span><span class='s2'>&quot;text/javascript&quot;</span><span class='o'>&gt;</span>

    <span class='nx'>jQuery</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>(</span><span class='nx'>$</span><span class='p'>)</span> <span class='p'>{</span>

        <span class='c1'>// prod_select ajax get function</span>
        <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#get_category&#39;</span><span class='p'>).</span><span class='nx'>live</span><span class='p'>(</span><span class='s1'>&#39;click&#39;</span><span class='p'>,</span><span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
            <span class='nx'>$</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s2'>&quot;/home/articles&quot;</span><span class='p'>,</span> <span class='p'>{</span><span class='nx'>cat</span><span class='o'>:</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#categories&#39;</span><span class='p'>).</span><span class='nx'>val</span><span class='p'>(),</span> <span class='nx'>sort</span><span class='o'>:</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#sort&#39;</span><span class='p'>).</span><span class='nx'>val</span><span class='p'>()},</span> <span class='kc'>null</span><span class='p'>,</span> <span class='s1'>&#39;script&#39;</span><span class='p'>);</span>
            <span class='k'>return</span> <span class='kc'>false</span><span class='p'>;</span>
        <span class='p'>});</span>
    <span class='p'>});</span>

<span class='o'>&lt;</span><span class='err'>/script&gt;</span>
</code></pre></div>
<p>Then in the <code>home_controller</code> <code>articles</code> method we refer to an articles.js <code>articles.js.erb</code> file, which has the same name as the <code>articles</code> method (we could call it something else, but then would have to specify name in the <code>respond_to</code> block):</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>def</span> <span class='nf'>articles</span>

  <span class='n'>category_selected</span> <span class='o'>=</span> <span class='n'>params</span><span class='o'>[</span><span class='ss'>:cat</span><span class='o'>]</span>
  
  <span class='n'>sort_by</span> <span class='o'>=</span> <span class='n'>params</span><span class='o'>[</span><span class='ss'>:sort</span><span class='o'>]</span>

  <span class='c1'>#do some magic with the params...</span>

  <span class='n'>respond_to</span> <span class='k'>do</span> <span class='o'>|</span><span class='nb'>format</span><span class='o'>|</span>
    <span class='nb'>format</span><span class='o'>.</span><span class='n'>html</span>
    <span class='nb'>format</span><span class='o'>.</span><span class='n'>js</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p><code>articles.js.erb</code> file, inserting a count (through erb) and a partial into the page, updating the displayed list of articles (songs):</p>
<div class='highlight'><pre><code class='javascript'><span class='cm'>/* comment */</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s2'>&quot;#articles_count&quot;</span><span class='p'>).</span><span class='nx'>html</span><span class='p'>(</span><span class='s2'>&quot;&lt;%= pluralize(@articles.count, &#39;Article&#39;) %&gt;&quot;</span><span class='p'>);</span>

<span class='cm'>/* comment */</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s2'>&quot;#articles&quot;</span><span class='p'>).</span><span class='nx'>html</span><span class='p'>(</span><span class='s2'>&quot;&lt;%= escape_javascript(render(&#39;home/article&#39;)) %&gt;&quot;</span><span class='p'>);</span>
</code></pre></div>
<p>The <code>render(&#39;home/article&#39;)</code> refers to a partial <code>_article.html.erb</code> that Rails inserts into the page:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;table&gt;</span>
  <span class='err'>&lt;</span>% @articles.each do |article| -%&gt;
     <span class='nt'>&lt;tr&gt;</span>
     <span class='nt'>&lt;td&gt;&lt;a</span> <span class='na'>href =</span><span class='err'> </span><span class='s'>&quot;/articles/&lt;%= article.id %&gt;&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;/assets/note.png&quot;</span><span class='nt'>/&gt;&lt;/a&gt;&lt;/td&gt;</span>
     <span class='nt'>&lt;td&gt;&lt;h2&gt;&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;/articles/&lt;%= article.id %&gt;&quot;</span><span class='nt'>&gt;&lt;strong&gt;</span><span class='err'>&lt;</span>%= article.name %&gt; - <span class='err'>&lt;</span>%= h truncate(article.description_en, :length =&gt; 80) %&gt;<span class='nt'>&lt;/strong&gt;&lt;/a&gt;&lt;/h2&gt;</span>

      <span class='nt'>&lt;p</span> <span class='na'>class=</span><span class='s'>&quot;summary&quot;</span><span class='nt'>&gt;</span><span class='err'>&lt;</span>%= article.description_en %&gt;<span class='nt'>&lt;/p&gt;</span>

    <span class='nt'>&lt;/td&gt;</span>
    <span class='nt'>&lt;/tr&gt;</span>
  <span class='err'>&lt;</span>% end -%&gt;
<span class='nt'>&lt;/table&gt;</span>
</code></pre></div>
<h4 id='ajax_post_request'>Ajax POST Request</h4>

<p>Same workflow as GET Request (see above) but jQuery Ajax helper would be using <code>$.post</code> instead of <code>$.get</code>.</p>

<p>Another way to create <code>Ajax POST</code> requests automatically is to use the <code>:remote =&gt; true</code> helper in Rails forms:</p>
<div class='highlight'><pre><code class='html'><span class='err'>&lt;</span>% form_tag products_path, :remote =&gt; true do %&gt;
  <span class='nt'>&lt;p&gt;</span>
    <span class='err'>&lt;</span>%= text_field_tag :search, params[:search] %&gt;
    <span class='err'>&lt;</span>%= submit_tag &quot;Search&quot;, :name =&gt; nil %&gt;
  <span class='nt'>&lt;/p&gt;</span>
<span class='err'>&lt;</span>% end %&gt;
</code></pre></div>
<p>Rails Guides simple Ajax example <a href='http://edgeguides.rubyonrails.org/working_with_javascript_in_rails.html#a-simple-example'>http://edgeguides.rubyonrails.org/working_with_javascript_in_rails.html#a-simple-example</a></p>

<p>There are also various Railscasts.com articles on Ajax/ jQuery that might be a useful - see <a href='http://railscasts.com/episodes/240-search-sort-paginate-with-ajax?view=asciicast'>http://railscasts.com/episodes/240-search-sort-paginate-with-ajax?view=asciicast</a></p>

<h3 id='emberjs'>Ember.js</h3>

<p>Refer to Ember.js Guides - see intro video <a href='http://emberjs.com/guides/'>http://emberjs.com/guides/</a>, Github project with code <a href='https://github.com/tildeio/bloggr-client'>https://github.com/tildeio/bloggr-client</a></p>

<p>Also Peepcode Episode on Ember - <a href='https://peepcode.com/products/emberjs'>https://peepcode.com/products/emberjs</a>, an inofficial Github project with code (might work, it&#8217;s a copy of Peepcode&#8217;s commercial offering) <a href='https://github.com/jordelver/peepcode-ember-js'>https://github.com/jordelver/peepcode-ember-js</a></p>

<p>Devmynd article on Ember.js - <a href='http://www.devmynd.com/blog/2013-3-rails-ember-js'>http://www.devmynd.com/blog/2013-3-rails-ember-js</a></p>

<p>Also - <a href='http://www.embercasts.com/'>http://www.embercasts.com/</a> and <a href='http://ember101.com/'>http://ember101.com/</a></p>

<p>Ember.js Routing magic - see <a href='http://emberjs.com/guides/routing/defining-your-routes/'>http://emberjs.com/guides/routing/defining-your-routes/</a></p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>App</span><span class='p'>.</span><span class='nx'>Router</span><span class='p'>.</span><span class='nx'>map</span><span class='p'>(</span><span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='k'>this</span><span class='p'>.</span><span class='nx'>resource</span><span class='p'>(</span><span class='s1'>&#39;posts&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>route</span><span class='p'>(</span><span class='s1'>&#39;new&#39;</span><span class='p'>);</span>
  <span class='p'>});</span>
<span class='p'>});</span>
</code></pre></div>
<p>creates the following routes:</p>
<table>
  <thead>
  <tr>
    <th>URL</th>
    <th>Route Name</th>
    <th>Controller</th>
    <th>Route</th>
    <th>Template</th>
  </tr>
  </thead>
  <tbody><tr>
    <td><code>/</code></td>
    <td><code>index</code></td>
    <td><code>IndexController</code></td>
    <td><code>IndexRoute</code></td>
    <td><code>index</code></td>
  </tr>
  <tr>
    <td>N/A</td>
    <td><code>posts</code><sup>1</sup></td>
    <td><code>PostsController</code></td>
    <td><code>PostsRoute</code></td>
    <td><code>posts</code></td>
  </tr>
  <tr>
    <td><code>/posts</code></td>
    <td><code>posts.index</code></td>
    <td><code>PostsController</code><br />↳<code>PostsIndexController</code></td>
    <td><code>PostsRoute</code><br />↳<code>PostsIndexRoute</code></td>
    <td><code>posts</code><br />↳<code>posts/index</code></td>
  </tr>
  <tr>
    <td><code>/posts/new</code></td>
    <td><code>posts.new</code></td>
    <td><code>PostsController</code><br />↳<code>PostsNewController</code></td>
    <td><code>PostsRoute</code><br />↳<code>PostsNewRoute</code></td>
    <td><code>posts</code><br />↳<code>posts/new</code></td>
  </tr>
</tbody></table>
<h3 id='angularjs'>Angular.js</h3>

<p>See - <a href='http://angularjs.org'>Angularjs.org</a> and Angular video intros <a href='http://www.egghead.io/'>http://www.egghead.io/</a></p>

<h2 id='rails_console__slide_8'>Rails Console - Slide 8</h2>

<h3 id='console'>console</h3>

<p>Rails console in production - <code>rails c RAILS_ENV=production</code> (in dev mode you can leave out the RAILS_ENV part).</p>

<h3 id='pry'>Pry</h3>

<p>Enhanced Rails console with data introspection and breakpoints etc. - <a href='http://railscasts.com/episodes/280-pry-with-rails?view=asciicast'>http://railscasts.com/episodes/280-pry-with-rails?view=asciicast</a></p>

<p>also <a href='https://github.com/pry/pry'>https://github.com/pry/pry</a></p>

<h2 id='admins__rails_admin_active_admin_netzke__slide_19'>Admins - Rails Admin, Active Admin, Netzke - Slide 19</h2>

<h3 id='rais_admin'>Rais Admin</h3>

<p>Rails admin - <a href='https://github.com/sferik/rails_admin'>https://github.com/sferik/rails_admin</a> and link to demo <a href='http://rails-admin-tb.herokuapp.com/'>http://rails-admin-tb.herokuapp.com/</a></p>

<h3 id='active_admin'>Active Admin</h3>

<p>Active Admin - <a href='http://activeadmin.info/'>http://activeadmin.info/</a>, Github <a href='https://github.com/gregbell/active_admin'>https://github.com/gregbell/active_admin</a></p>

<h3 id='netzke'>Netzke</h3>

<p>Creates Grids based on ExtJS - <a href='http://netzke.org/'>http://netzke.org/</a></p>

<h2 id='authentication_authorization__slide_5'>Authentication, Authorization - Slide 5</h2>

<h3 id='autentication__sorcery_devise'>Autentication - Sorcery, Devise</h3>

<p>Authentication with Sorcery - <a href='https://github.com/NoamB/sorcery'>https://github.com/NoamB/sorcery</a>, see Wiki install and configuration <a href='https://github.com/NoamB/sorcery/wiki'>https://github.com/NoamB/sorcery/wiki</a></p>

<p>Authentication with Devise - <a href='https://github.com/plataformatec/devise'>https://github.com/plataformatec/devise</a>, see Wiki <a href='https://github.com/plataformatec/devise/wiki'>https://github.com/plataformatec/devise/wiki</a></p>

<h3 id='authorization__cancan_example'>Authorization - CanCan Example</h3>

<p>Authorization with CanCan - <a href='https://github.com/ryanb/cancan'>https://github.com/ryanb/cancan</a>, CanCan Wiki <a href='https://github.com/ryanb/cancan/wiki'>https://github.com/ryanb/cancan/wiki</a></p>

<p>CanCan Ability model class example:</p>

<p>See also Railscasts episodes on CanCan - <a href='http://railscasts.com/episodes/192-authorization-with-cancan?view=asciicast'>http://railscasts.com/episodes/192-authorization-with-cancan?view=asciicast</a></p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Ability</span>
  <span class='kp'>include</span> <span class='ss'>CanCan</span><span class='p'>:</span><span class='ss'>:Ability</span>
  <span class='kp'>include</span> <span class='no'>ApplicationHelper</span>

  <span class='c1'>#def initialize(user)</span>
    <span class='c1'># Define abilities for the passed in user here. For example:</span>
    <span class='c1'>#</span>
    <span class='c1'>#   user ||= User.new # guest user (not logged in)</span>
    <span class='c1'>#   if user.admin?</span>
    <span class='c1'>#     can :manage, :all</span>
    <span class='c1'>#   else</span>
    <span class='c1'>#     can :read, :all</span>
    <span class='c1'>#   end</span>
    <span class='c1'>#</span>
    <span class='c1'># The first argument to `can` is the action you are giving the user </span>
    <span class='c1'># permission to do.</span>
    <span class='c1'># If you pass :manage it will apply to every action. Other common actions</span>
    <span class='c1'># here are :read, :create, :update and :destroy.</span>
    <span class='c1'>#</span>
    <span class='c1'># The second argument is the resource the user can perform the action on. </span>
    <span class='c1'># If you pass :all it will apply to every resource. Otherwise pass a Ruby</span>
    <span class='c1'># class of the resource.</span>
    <span class='c1'>#</span>
    <span class='c1'># The third argument is an optional hash of conditions to further filter the</span>
    <span class='c1'># objects.</span>
    <span class='c1'># For example, here the user can only update published articles.</span>
    <span class='c1'>#</span>
    <span class='c1'>#   can :update, Article, :published =&gt; true</span>
    <span class='c1'>#</span>
    <span class='c1'># See the wiki for details:</span>
    <span class='c1'># https://github.com/ryanb/cancan/wiki/Defining-Abilities</span>
  <span class='c1'>#end</span>

  <span class='k'>def</span> <span class='nf'>initialize</span><span class='p'>(</span><span class='n'>user</span><span class='p'>)</span>
    <span class='vi'>@user</span> <span class='o'>=</span> <span class='n'>user</span> <span class='o'>||</span> <span class='no'>User</span><span class='o'>.</span><span class='n'>new</span> <span class='c1'># for guest</span>
    <span class='vi'>@user</span><span class='o'>.</span><span class='n'>roles</span><span class='o'>.</span><span class='n'>each</span> <span class='p'>{</span> <span class='o'>|</span><span class='n'>role</span><span class='o'>|</span> <span class='nb'>send</span><span class='p'>(</span><span class='n'>role</span><span class='o'>.</span><span class='n'>name</span><span class='o'>.</span><span class='n'>to_sym</span><span class='p'>)</span> <span class='p'>}</span>
    <span class='vi'>@organizations</span> <span class='o'>=</span> <span class='no'>Organization</span><span class='o'>.</span><span class='n'>all</span>

    <span class='k'>if</span> <span class='vi'>@user</span><span class='o'>.</span><span class='n'>roles</span><span class='o'>.</span><span class='n'>size</span> <span class='o'>==</span> <span class='mi'>0</span>
      <span class='n'>can</span> <span class='ss'>:read</span><span class='p'>,</span> <span class='ss'>:all</span> <span class='c1'>#for guest without roles</span>
    <span class='k'>end</span>
  <span class='k'>end</span>

  <span class='k'>def</span> <span class='nf'>account</span>

    <span class='c1'>#can [:manage], [Organization, User, CustomerRecord, AdminRecord, Vendor, Product, PriceList, BankRecord, CreditCardRecord, Category, Page, Location, Order, LineItem, OrderTransaction, Access]</span>
    <span class='n'>can</span> <span class='ss'>:manage</span><span class='p'>,</span> <span class='ss'>:all</span>
    <span class='c1'>#exceptions_to_rules</span>
  <span class='k'>end</span>

  <span class='k'>def</span> <span class='nf'>exceptions_to_rules</span>
    <span class='n'>cannot</span> <span class='ss'>:destroy</span><span class='p'>,</span> <span class='no'>Organization</span>
  <span class='k'>end</span>

  <span class='k'>def</span> <span class='nf'>management</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='p'>,</span> <span class='ss'>:create</span><span class='p'>,</span> <span class='ss'>:update</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>Organization</span><span class='p'>,</span> <span class='no'>User</span><span class='p'>,</span> <span class='no'>CustomerRecord</span><span class='p'>,</span> <span class='no'>AdminRecord</span><span class='p'>,</span> <span class='no'>Vendor</span><span class='p'>,</span> <span class='no'>Product</span><span class='p'>,</span> <span class='no'>PriceList</span><span class='p'>,</span> <span class='no'>BankRecord</span><span class='p'>,</span> <span class='no'>CreditCardRecord</span><span class='p'>,</span> <span class='no'>Location</span><span class='p'>,</span> <span class='no'>Order</span><span class='p'>,</span> <span class='no'>OrderTransaction</span><span class='p'>,</span> <span class='no'>Access</span><span class='o'>]</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>Category</span><span class='p'>,</span> <span class='no'>LineItem</span><span class='o'>]</span>
  <span class='k'>end</span>

  <span class='k'>def</span> <span class='nf'>management_division</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='p'>,</span> <span class='ss'>:create</span><span class='p'>,</span> <span class='ss'>:update</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>Organization</span><span class='p'>,</span> <span class='no'>User</span><span class='p'>,</span> <span class='no'>CustomerRecord</span><span class='p'>,</span> <span class='no'>AdminRecord</span><span class='p'>,</span> <span class='no'>Vendor</span><span class='p'>,</span> <span class='no'>Product</span><span class='p'>,</span> <span class='no'>PriceList</span><span class='p'>,</span> <span class='no'>BankRecord</span><span class='p'>,</span> <span class='no'>CreditCardRecord</span><span class='p'>,</span> <span class='no'>Category</span><span class='p'>,</span> <span class='no'>Location</span><span class='p'>,</span> <span class='no'>Order</span><span class='p'>,</span> <span class='no'>LineItem</span><span class='p'>,</span> <span class='no'>OrderTransaction</span><span class='p'>,</span> <span class='no'>Access</span><span class='o'>]</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>Category</span><span class='p'>,</span> <span class='no'>LineItem</span><span class='o'>]</span>
  <span class='k'>end</span>

  <span class='k'>def</span> <span class='nf'>staff</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='p'>,</span> <span class='ss'>:create</span><span class='p'>,</span> <span class='ss'>:update</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>User</span><span class='p'>,</span> <span class='no'>CustomerRecord</span><span class='o'>]</span>
    <span class='n'>can</span> <span class='o'>[</span><span class='ss'>:read</span><span class='o'>]</span><span class='p'>,</span> <span class='o'>[</span><span class='no'>Organization</span><span class='p'>,</span> <span class='no'>Category</span><span class='p'>,</span> <span class='no'>PriceList</span><span class='p'>,</span> <span class='no'>AdminRecord</span><span class='p'>,</span> <span class='no'>Vendor</span><span class='o'>]</span>
  <span class='k'>end</span>


<span class='k'>end</span>
</code></pre></div>
<p>In <code>user.rb</code> model you create the helper method <code>role?</code>, which helps pass in the associated roles table by collecting the role names (many-to-one relationship between Role and User), which <code>ability.rb</code> then refers to in the <code>initialize</code> method dynamically for each user (using <code>send()</code> to turn role name strings into methods, e.g. <code>def management</code> <code>def staff</code> etc.).</p>
<div class='highlight'><pre><code class='ruby'> <span class='k'>def</span> <span class='nf'>role?</span><span class='p'>(</span><span class='n'>role</span><span class='p'>)</span>
    <span class='n'>roles</span><span class='o'>.</span><span class='n'>map</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>s</span><span class='o'>|</span> <span class='n'>s</span><span class='o'>.</span><span class='n'>name</span><span class='p'>}</span><span class='o'>.</span><span class='n'>include?</span> <span class='n'>role</span><span class='o'>.</span><span class='n'>to_s</span>
  <span class='k'>end</span>
</code></pre></div>
<p>Finally (taken from Railscast Article), if you refer (with logged in user) with the <code>can?</code> view helper method to the user&#8217;s abilities, it filters for allowed operations (which can be any operation which has been defined in CanCan&#8217;s ability class, not only CRUD operations - create, read, update, delete). CanCan automatically attaches abilities to the controllers. Example of view helper using CanCan:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;p&gt;</span>
  <span class='err'>&lt;</span>% if can? :update, @article %&gt;
    <span class='err'>&lt;</span>%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt; |
  <span class='err'>&lt;</span>% end %&gt;
  <span class='err'>&lt;</span>% if can? :destroy, @article %&gt;
    <span class='err'>&lt;</span>%= link_to &quot;Destroy&quot;, @article, :method =&gt; :delete, :confirm =&gt; &quot;Are you sure?&quot; %&gt; |
  <span class='err'>&lt;</span>% end %&gt;
  <span class='err'>&lt;</span>%= link_to &quot;Back to Articles&quot;, articles_path %&gt;
<span class='nt'>&lt;/p&gt;</span>
</code></pre></div>
<h2 id='active_record_finder__slide_7'>Active Record Finder - Slide 7</h2>

<h3 id='where'>Where</h3>

<p>See Rails Guides article - <a href='http://guides.rubyonrails.org/active_record_querying.html'>http://guides.rubyonrails.org/active_record_querying.html</a></p>

<h3 id='search_scopes'>Search scopes</h3>

<p>Search scopes (Devmynd Article) - <a href='http://www.devmynd.com/blog/2013-3-effective-rails-part-2-hiding-activerecord'>http://www.devmynd.com/blog/2013-3-effective-rails-part-2-hiding-activerecord</a></p>

<p>Hiding Actice Record behind search scopes:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># app/models/order.rb</span>
<span class='k'>class</span> <span class='nc'>Order</span> <span class='o'>&lt;</span> <span class='ss'>ActiveRecord</span><span class='p'>:</span><span class='ss'>:Base</span>

  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>recent_open_orders_for_customer</span><span class='p'>(</span><span class='n'>customer</span><span class='p'>,</span> <span class='n'>page</span><span class='p'>,</span> <span class='n'>size</span><span class='o'>=</span><span class='mi'>20</span><span class='p'>)</span>
    <span class='nb'>open</span><span class='o'>.</span><span class='n'>for_customer</span><span class='p'>(</span><span class='n'>customer</span><span class='p'>)</span><span class='o'>.</span><span class='n'>by_recency</span><span class='o'>.</span><span class='n'>paged</span><span class='p'>(</span><span class='n'>page</span><span class='p'>,</span> <span class='n'>size</span><span class='p'>)</span><span class='o'>.</span><span class='n'>to_a</span>
  <span class='k'>end</span>

  <span class='n'>scope</span> <span class='ss'>:open</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>{</span> <span class='n'>where</span><span class='p'>(</span><span class='ss'>status</span><span class='p'>:</span> <span class='s2'>&quot;open&quot;</span><span class='p'>)</span> <span class='p'>}</span>
  <span class='n'>scope</span> <span class='ss'>:for_customer</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>(</span><span class='n'>customer</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>where</span><span class='p'>(</span><span class='ss'>customer</span><span class='p'>:</span> <span class='n'>customer</span><span class='p'>)</span> <span class='p'>}</span>
  <span class='n'>scope</span> <span class='ss'>:by_recency</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>{</span> <span class='n'>order</span><span class='p'>(</span><span class='s2'>&quot;created_at DESC&quot;</span><span class='p'>)</span> <span class='p'>}</span>
  <span class='n'>scope</span> <span class='ss'>:paged</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>(</span><span class='n'>page</span><span class='p'>,</span> <span class='n'>size</span><span class='o'>=</span><span class='mi'>20</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>offset</span><span class='p'>(</span><span class='n'>size</span><span class='p'>)</span><span class='o'>.</span><span class='n'>limit</span><span class='p'>(</span><span class='n'>size</span><span class='p'>)</span> <span class='p'>}</span>

<span class='k'>end</span>

<span class='c1'># app/controllers/orders_controller.rb</span>
<span class='k'>class</span> <span class='nc'>OrdersController</span> <span class='o'>&lt;</span> <span class='no'>ApplicationController</span>

  <span class='k'>def</span> <span class='nf'>index</span>
    <span class='vi'>@orders</span> <span class='o'>=</span> <span class='no'>Order</span><span class='o'>.</span><span class='n'>recent_open_orders_for_customer</span><span class='p'>(</span>
      <span class='n'>current_customer</span><span class='p'>,</span> <span class='n'>params</span><span class='o'>[</span><span class='ss'>:page</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>params</span><span class='o'>[</span><span class='ss'>:page_size</span><span class='o'>]</span><span class='p'>)</span>
  <span class='k'>end</span>

<span class='k'>end</span>
</code></pre></div>
<h2 id='active_record_associations__slide_10'>Active Record Associations - Slide 10</h2>

<p>has_many, belongs_to, has_many :through</p>

<p>acts_as_tree - <a href='https://github.com/amerine/acts_as_tree'>https://github.com/amerine/acts_as_tree</a>, a bit dated but still functional <a href='http://railscasts.com/episodes/162-tree-based-navigation?view=asciicast'>http://railscasts.com/episodes/162-tree-based-navigation?view=asciicast</a></p>

<p>awesome_nested_set (nested set) - <a href='https://github.com/collectiveidea/awesome_nested_set/'>https://github.com/collectiveidea/awesome_nested_set/</a></p>

<p>polymorphic associations</p>

<p>many_to_many with behaviour</p>

<p>STI - single table inheritance</p>

<p>see ‘Rails Recipes’ book, or ‘Rails Cookbook’ (contain many of these examples)</p>

<h2 id='storing_flexible_data_nosql__slide_11'>Storing Flexible Data, NoSQL - Slide 11</h2>

<p>Postgres Hstore - see DevMynd article <a href='http://www.devmynd.com/blog/2013-3-single-table-inheritance-hstore-lovely-combination'>http://www.devmynd.com/blog/2013-3-single-table-inheritance-hstore-lovely-combination</a></p>

<p>Active Record Postgres hstore gem - <a href='https://github.com/engageis/activerecord-postgres-hstore'>https://github.com/engageis/activerecord-postgres-hstore</a></p>

<p>hstore gem is built into Rails 4</p>

<p>Serializing flexible attributes into Rails, built into Rails 3.</p>

<p>Referring to PDF doc ‘Postgres Experts - Simplifying DB Design’ - <a href='/assets/simple_db.pdf'>simple_db.pdf</a></p>

<p>Concepts from PDF:</p>

<p>EAV tables (‘Eavil table’) data blob (‘e-blob’)</p>

<h3 id='mongodb__no_transactions'>MongoDB - no transactions</h3>

<p>Faking out transactions in MongoDB - <a href='http://blog.mongodb.org/post/7494240825/master-detail-transactions-in-mongodb'>http://blog.mongodb.org/post/7494240825/master-detail-transactions-in-mongodb</a></p>

<h3 id='postgresql_93__fdw_integrating_redis_mongodb'>Postgresql 9.3 - FDW (integrating Redis, MongoDB)</h3>

<p>PostgreSQL 9.3 beta: Federated databases and more - <a href='http://lwn.net/Articles/550418/'>http://lwn.net/Articles/550418/</a></p>

<p>See &#8216;Linking PostgreSQL to Redis&#8217; in article.</p>

<h3 id='postgresql_new_features'>PostGresql new features</h3>

<p>links - <a href='https://postgres.heroku.com/blog/past/2012/3/14/introducing_keyvalue_data_storage_in_heroku_postgres/'>https://postgres.heroku.com/blog/past/2012/3/14/introducing_keyvalue_data_storage_in_heroku_postgres/</a>, <a href='http://postgres-bits.herokuapp.com/#1'>Postgres the bits you haven&#8217;t found</a>, <a href='http://plv8-pgconfeu.herokuapp.com/#1'>Embracing the Web with JSON and V8</a>, <a href='http://schneems.com/post/19298469372/you-got-nosql-in-my-postgres-using-hstore-in-rails'>NoSQL in Postgres intro</a></p>

<h2 id='rails_asset_pipeline_twitter_bootstrap_framework__slide_17'>Rails Asset Pipeline, Twitter Bootstrap Framework - Slide 17</h2>

<h3 id='asset_pipeline'>Asset Pipeline</h3>

<p>Rails Guides to Asset Pipeline - <a href='http://guides.rubyonrails.org/asset_pipeline.html'>http://guides.rubyonrails.org/asset_pipeline.html</a></p>

<h3 id='integrating_bootstrap_less_sass'>Integrating Bootstrap, Less, SASS</h3>

<p>Twitter Bootstrap - <a href='http://twitter.github.io/bootstrap/'>http://twitter.github.io/bootstrap/</a></p>

<p>Less - <a href='http://lesscss.org/'>http://lesscss.org/</a></p>

<p>SASS - <a href='http://sass-lang.com/'>http://sass-lang.com/</a></p>

<h2 id='handling_data_csv_excel_pdf_generation__slide_16'>Handling Data, CSV, Excel, PDF generation - Slide 16</h2>

<h3 id='csv_import'>CSV Import</h3>

<p>Note - <code>db/seeds.rb</code> is the preferred way to create db data e.g. <code>rake db:seed</code> (or <code>rake db:seed RAILS_ENV=production</code>), also <a href='http://edgeguides.rubyonrails.org/migrations.html#migrations-and-seed-data'>http://edgeguides.rubyonrails.org/migrations.html#migrations-and-seed-data</a></p>

<p>CSV import - create a <code>load_data.rake</code> task in <code>lib/tasks</code> directory of Rails app. Example of complex load task (one could split these up into separate rake tasks) - execute task with <code>rake db:load:load_data</code>:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># Provide tasks to load and delete data.</span>
<span class='nb'>require</span> <span class='s1'>&#39;active_record&#39;</span>
<span class='nb'>require</span> <span class='s1'>&#39;active_record/fixtures&#39;</span>

<span class='n'>namespace</span> <span class='ss'>:db</span> <span class='k'>do</span>
  <span class='no'>DATA_DIRECTORY</span> <span class='o'>=</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>join</span><span class='p'>(</span><span class='no'>Rails</span><span class='o'>.</span><span class='n'>root</span><span class='p'>,</span> <span class='s2'>&quot;lib&quot;</span><span class='p'>,</span> <span class='s2'>&quot;tasks&quot;</span><span class='p'>,</span> <span class='s2'>&quot;load_csv&quot;</span><span class='p'>)</span>
  <span class='n'>namespace</span> <span class='ss'>:load_data</span> <span class='k'>do</span> 
    <span class='no'>TABLES</span> <span class='o'>=</span> <span class='sx'>%w(categories products)</span>
    <span class='c1'>#MIN_USER_ID = 100    # Starting user id for the sample data</span>
  
    <span class='n'>desc</span> <span class='s2'>&quot;Load data&quot;</span>
    <span class='n'>task</span> <span class='ss'>:load</span> <span class='o'>=&gt;</span> <span class='ss'>:environment</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>t</span><span class='o'>|</span>
      <span class='nb'>require</span> <span class='s1'>&#39;csv&#39;</span>
      
      <span class='no'>CSV</span><span class='o'>.</span><span class='n'>foreach</span><span class='p'>(</span><span class='s2'>&quot;lib/tasks/load_csv/categories.csv&quot;</span><span class='p'>,</span> <span class='ss'>:headers</span> <span class='o'>=&gt;</span> <span class='kp'>true</span><span class='p'>)</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>row</span><span class='o'>|</span>
        <span class='no'>Category</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:name</span> <span class='o'>=&gt;</span> <span class='n'>row</span><span class='o'>[</span><span class='s1'>&#39;name&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='ss'>:description</span> <span class='o'>=&gt;</span> <span class='n'>row</span><span class='o'>[</span><span class='s1'>&#39;description&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='ss'>:created_at</span> <span class='o'>=&gt;</span> <span class='no'>Time</span><span class='o'>.</span><span class='n'>now</span><span class='p'>,</span> <span class='ss'>:updated_at</span> <span class='o'>=&gt;</span> <span class='no'>Time</span><span class='o'>.</span><span class='n'>now</span><span class='p'>)</span>
      <span class='k'>end</span>
      <span class='nb'>puts</span> <span class='s2'>&quot;categories o.k.&quot;</span>
      
      <span class='no'>CSV</span><span class='o'>.</span><span class='n'>foreach</span><span class='p'>(</span><span class='s2'>&quot;lib/tasks/load_csv/products.csv&quot;</span><span class='p'>,</span> <span class='ss'>:headers</span> <span class='o'>=&gt;</span> <span class='kp'>true</span><span class='p'>,</span> <span class='ss'>:col_sep</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;,&quot;</span><span class='p'>)</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>row</span><span class='o'>|</span>
        <span class='no'>Product</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:organization_id</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;1&#39;</span><span class='p'>,</span> <span class='ss'>:vendor_id</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;1&#39;</span><span class='p'>,</span> <span class='ss'>:category_id</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;1&#39;</span><span class='p'>,</span> 
        <span class='ss'>:made_in_canada</span> <span class='o'>=&gt;</span> <span class='kp'>false</span><span class='p'>,</span> <span class='ss'>:available</span> <span class='o'>=&gt;</span> <span class='n'>row</span><span class='o'>[</span><span class='s1'>&#39;available&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='ss'>:manufacturer_nr</span> <span class='o'>=&gt;</span> <span class='n'>row</span><span class='o'>[</span><span class='s1'>&#39;manufacturer_nr&#39;</span><span class='o'>]</span><span class='p'>,</span>
        <span class='ss'>:created_at</span> <span class='o'>=&gt;</span> <span class='no'>Time</span><span class='o'>.</span><span class='n'>now</span><span class='p'>,</span> <span class='ss'>:updated_at</span> <span class='o'>=&gt;</span> <span class='no'>Time</span><span class='o'>.</span><span class='n'>now</span><span class='p'>)</span>
      <span class='k'>end</span>
      <span class='nb'>puts</span> <span class='s2'>&quot;products o.k.&quot;</span>
      
    <span class='k'>end</span>
      
    <span class='n'>desc</span> <span class='s2'>&quot;Remove data&quot;</span> 
    <span class='n'>task</span> <span class='ss'>:delete</span> <span class='o'>=&gt;</span> <span class='ss'>:environment</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>t</span><span class='o'>|</span>
      <span class='no'>TABLES</span><span class='o'>.</span><span class='n'>each</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>t</span><span class='o'>|</span>
        <span class='n'>klass</span> <span class='o'>=</span> <span class='n'>t</span><span class='o'>.</span><span class='n'>classify</span><span class='o'>.</span><span class='n'>constantize</span>
        <span class='c1'>#id = klass == User ? &quot;id&quot; : &quot;user_id&quot;</span>
        <span class='c1'>#klass.delete_all(&quot;#{id} &gt;= #{MIN_USER_ID}&quot;)</span>
        <span class='n'>klass</span><span class='o'>.</span><span class='n'>delete_all</span>
      <span class='k'>end</span>
    <span class='k'>end</span>
  <span class='k'>end</span>

<span class='k'>end</span>
</code></pre></div>
<p>It reads in various CSV files in the <code>lib/tasks/load_csv</code> directory, e.g. <code>categories.csv</code>:</p>

<pre><code>name,description
garden,garden products
bath,bath products</code></pre>

<h3 id='pdf_generation'>PDF generation</h3>

<p>Prawn - <a href='http://prawn.majesticseacreature.com/'>http://prawn.majesticseacreature.com/</a> and <a href='https://github.com/prawnpdf/prawn'>https://github.com/prawnpdf/prawn</a></p>

<p>Or PDFKit - <a href='https://github.com/pdfkit/pdfkit'>https://github.com/pdfkit/pdfkit</a>, also PDF toolkit (large collections of PDFs) - <a href='http://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/'>http://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/</a></p>

<p>Simple example with Prawn:</p>
<div class='highlight'><pre><code class='ruby'><span class='nb'>require</span> <span class='s1'>&#39;prawn&#39;</span>

<span class='ss'>Prawn</span><span class='p'>:</span><span class='ss'>:Document</span><span class='o'>.</span><span class='n'>generate</span><span class='p'>(</span><span class='s1'>&#39;hello.pdf&#39;</span><span class='p'>)</span> <span class='k'>do</span> <span class='o'>|</span><span class='n'>pdf</span><span class='o'>|</span>
  <span class='n'>pdf</span><span class='o'>.</span><span class='n'>text</span><span class='p'>(</span><span class='s2'>&quot;Hello Prawn!&quot;</span><span class='p'>)</span>
<span class='k'>end</span>
</code></pre></div>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#rails-ref">
    		rails <span>1</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#rails-ref">rails <span>1</span></a></li>
     
    	<li><a href="/tags.html#javascript-ref">javascript <span>1</span></a></li>
     
    	<li><a href="/tags.html#training-ref">training <span>1</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev disabled"><a>&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/mobile/2013/06/04/no-soldering" title="No soldering">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
    
 
  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2013 movebits. 
          Published with <a href="http://jekyllrb.com" target="_blank" title="Jekyll Blogging Framework">Jekyll</a>.
        </p>
      </footer>

    </div>

    


    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34997876-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>

